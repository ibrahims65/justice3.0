<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Case Details</title>
  <link href="/css/style.css" rel="stylesheet">
</head>
<body>
  <div class="container mx-auto">
    <h1 class="text-2xl font-bold">Case Details</h1>
    <p><strong>Case Number:</strong> <%= caseRecord.caseNumber %></p>
    <p><strong>Status:</strong> <%= caseRecord.status %></p>
    <h2 class="text-xl font-bold mt-4">Inmate Details</h2>
    <p><strong>Name:</strong> <%= caseRecord.inmate.name %></p>
    <p><strong>Date of Birth:</strong> <%= caseRecord.inmate.dob.toDateString() %></p>
    <p><strong>Status:</strong> <%= caseRecord.inmate.status %></p>
    <% if (caseRecord.inmate.photoUrl) { %>
      <img src="<%= caseRecord.inmate.photoUrl %>" alt="Inmate Photo" class="w-64 h-64">
    <% } %>

    <h2 class="text-xl font-bold mt-4">Action History</h2>
    <ul>
      <% caseRecord.actions.forEach(action => { %>
        <li><%= action.timestamp.toLocaleString() %> - <%= action.action %> by <%= action.user.username %></li>
      <% }) %>
    </ul>

    <h2 class="text-xl font-bold mt-4">Evidence</h2>
    <ul>
      <% caseRecord.evidence.forEach(item => { %>
        <li><%= item.description %> - <a href="<%= item.fileUrl %>" class="text-blue-500">View</a></li>
      <% }) %>
    </ul>
    <a href="/evidence/new/<%= caseRecord.id %>" class="text-blue-500">Add Evidence</a>

    <h2 class="text-xl font-bold mt-4">Witnesses</h2>
    <ul>
      <% caseRecord.witnesses.forEach(witness => { %>
        <li><strong><%= witness.name %>:</strong> <%= witness.statement %></li>
      <% }) %>
    </ul>
    <a href="/witnesses/new/<%= caseRecord.id %>" class="text-blue-500">Add Witness</a>

    <% if (caseRecord.status === 'New Arrest' && user.role.name === 'Police') { %>
      <form action="/cases/<%= caseRecord.id %>/submit" method="POST" class="mt-4">
        <button type="submit" class="bg-green-500 text-white p-2 rounded">Submit to Prosecutor</button>
      </form>
    <% } %>

    <% if (caseRecord.status === 'Prosecutor Review' && user.role.name === 'Prosecutor') { %>
      <div class="mt-4">
        <form action="/cases/<%= caseRecord.id %>/accept" method="POST" class="inline-block">
          <button type="submit" class="bg-green-500 text-white p-2 rounded">Accept</button>
        </form>
        <form action="/cases/<%= caseRecord.id %>/reject" method="POST" class="inline-block">
          <button type="submit" class="bg-red-500 text-white p-2 rounded">Reject</button>
        </form>
        <form action="/cases/<%= caseRecord.id %>/request-info" method="POST" class="inline-block">
          <button type="submit" class="bg-yellow-500 text-white p-2 rounded">Request More Info</button>
        </form>
      </div>
    <% } %>
  </div>
</body>
</html>
