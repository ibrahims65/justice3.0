<%- include('../partials/header', { title: 'Court Dashboard', user: user, page: '/court/dashboard' }) %>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-medium text-gray-800">Cases for Review</h3>
    <p class="text-3xl font-bold text-yellow-500"><%= cases.filter(c => c.status === 'Submitted to Court').length %></p>
  </div>
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-medium text-gray-800">Upcoming Hearings</h3>
    <p class="text-3xl font-bold text-purple-500"><%= cases.reduce((acc, c) => acc + c.hearings.filter(h => !h.verdict).length, 0) %></p>
  </div>
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-lg font-medium text-gray-800">Cases Awaiting Verdict</h3>
    <p class="text-3xl font-bold text-purple-500"><%= cases.filter(c => c.status === 'Accepted' && c.hearings.some(h => !h.verdict)).length %></p>
  </div>
</div>

<div class="mt-8 bg-white rounded-lg shadow-md p-6">
  <h3 class="text-lg font-medium text-gray-800 mb-4">Cases for Review</h3>
  <table class="w-full">
    <thead>
      <tr>
        <th class="text-left">Case Number</th>
        <th class="text-left">Person</th>
        <th class="text-left">Status</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% cases.filter(c => c.status === 'Submitted to Court').forEach(caseItem => { %>
        <tr>
          <td><a href="/cases/<%= caseItem.id %>" class="text-blue-500 hover:underline"><%= caseItem.caseNumber %></a></td>
          <td><%= caseItem.booking.person.name %></td>
          <td><%= caseItem.status %></td>
          <td>
            <a href="/cases/<%= caseItem.id %>" class="text-blue-500 hover:underline">View Case</a>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</div>

<div class="mt-8 bg-white rounded-lg shadow-md p-6">
  <h3 class="text-lg font-medium text-gray-800 mb-4">Upcoming Hearings</h3>
  <table class="w-full">
    <thead>
      <tr>
        <th class="text-left">Case Number</th>
        <th class="text-left">Person</th>
        <th class="text-left">Hearing Date</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <% cases.forEach(caseItem => { %>
        <% caseItem.hearings.forEach(hearing => { %>
          <% if (!hearing.verdict) { %>
            <tr>
              <td><a href="/cases/<%= caseItem.id %>" class="text-blue-500 hover:underline"><%= caseItem.caseNumber %></a></td>
              <td><%= caseItem.booking.person.name %></td>
              <td><%= hearing.hearingDate.toLocaleString() %></td>
              <td>
                <a href="/cases/<%= caseItem.id %>" class="text-blue-500 hover:underline">View Case</a>
              </td>
            </tr>
          <% } %>
        <% }) %>
      <% }) %>
    </tbody>
  </table>
</div>
