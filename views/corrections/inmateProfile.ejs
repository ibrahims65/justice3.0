<!DOCTYPE html>
<html>
<head>
  <title>Inmate Profile</title>
  <link rel="stylesheet" href="/css/input.css">
</head>
<body>
  <div class="container mx-auto p-4">
    <h1 class="text-2xl font-bold mb-4">Inmate Profile: <%= person.name %></h1>
    <div class="tabs">
      <button class="tab-button active" onclick="openTab(event, 'medical')">Medical</button>
      <button class="tab-button" onclick="openTab(event, 'legal')">Legal</button>
      <button class="tab-button" onclick="openTab(event, 'rehabilitation')">Rehabilitation</button>
    </div>

    <div id="medical" class="tab-content">
      <% person.bookings.forEach(booking => { %>
        <div class="border-b border-gray-200 py-4">
          <h4 class="font-bold">Booking #<%= booking.id %></h4>
          <a href="/medical-records/new/<%= booking.id %>" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4 inline-block">Add Medical Record</a>
          <ul>
            <% booking.medicalRecords.forEach(record => { %>
              <li class="border-b border-gray-200 py-4">
                <p><strong>Condition:</strong> <%= record.condition %></p>
                <p><strong>Allergies:</strong> <%= record.allergies %></p>
                <p><strong>Notes:</strong> <%= record.notes %></p>
                <a href="/medical-records/<%= record.id %>/medications/new" class="text-blue-500 hover:underline">Add Medication</a>
                <h4 class="font-bold mt-4">Medications</h4>
                <ul>
                  <% record.medications.forEach(med => { %>
                    <li class="border-t border-gray-200 py-2">
                      <p><strong>Medication:</strong> <%= med.medication %></p>
                      <p><strong>Dosage:</strong> <%= med.dosage %></p>
                      <p><strong>Frequency:</strong> <%= med.frequency %></p>
                    </li>
                  <% }) %>
                </ul>
              </li>
            <% }) %>
          </ul>
        </div>
      <% }) %>
    </div>

    <div id="legal" class="tab-content" style="display:none;">
      <% person.bookings.forEach(booking => { %>
        <div class="border-b border-gray-200 py-4">
          <h4 class="font-bold">Booking #<%= booking.id %></h4>
          <a href="/lawyers/new/<%= booking.id %>" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mb-4 inline-block">Add Lawyer</a>
          <ul>
            <% booking.lawyers.forEach(lawyer => { %>
              <li class="border-b border-gray-200 py-4">
                <p><strong>Name:</strong> <%= lawyer.name %></p>
                <p><strong>Firm:</strong> <%= lawyer.firm %></p>
                <p><strong>License:</strong> <%= lawyer.license %></p>
                <a href="/lawyers/<%= lawyer.id %>/visits/new" class="text-blue-500 hover:underline">Add Visit</a>
                <h4 class="font-bold mt-4">Visits</h4>
                <ul>
                  <% lawyer.visits.forEach(visit => { %>
                    <li class="border-t border-gray-200 py-2">
                      <p><strong>Date:</strong> <%= visit.visitDate.toLocaleString() %></p>
                      <p><strong>Notes:</strong> <%= visit.notes %></p>
                    </li>
                  <% }) %>
                </ul>
              </li>
            <% }) %>
          </ul>
        </div>
      <% }) %>
    </div>

    <div id="rehabilitation" class="tab-content" style="display:none;">
      <% person.bookings.forEach(booking => { %>
        <div class="border-b border-gray-200 py-4">
          <h4 class="font-bold">Booking #<%= booking.id %></h4>
          <form action="/corrections/inmates/<%= booking.id %>" method="POST">
            <div class="mb-4">
              <label for="incarcerationStartDate" class="block text-gray-700">Incarceration Start Date</label>
              <input type="date" name="incarcerationStartDate" id="incarcerationStartDate" value="<%= booking.incarcerationStartDate ? booking.incarcerationStartDate.toISOString().split('T')[0] : '' %>" class="w-full border rounded p-2">
            </div>
            <div class="mb-4">
              <label for="facilityName" class="block text-gray-700">Facility Name</label>
              <input type="text" name="facilityName" id="facilityName" value="<%= booking.facilityName || '' %>" class="w-full border rounded p-2">
            </div>
            <div class="mb-4">
              <label for="rehabilitationPrograms" class="block text-gray-700">Rehabilitation Programs</label>
              <input type="text" name="rehabilitationPrograms" id="rehabilitationPrograms" value="<%= booking.rehabilitationPrograms || '' %>" class="w-full border rounded p-2">
            </div>
            <div class="mb-4">
              <label for="releaseDate" class="block text-gray-700">Release Date</label>
              <input type="date" name="releaseDate" id="releaseDate" value="<%= booking.releaseDate ? booking.releaseDate.toISOString().split('T')[0] : '' %>" class="w-full border rounded p-2">
            </div>
            <div class="mb-4">
              <label for="paroleEligibility" class="block text-gray-700">Parole Eligibility</label>
              <input type="date" name="paroleEligibility" id="paroleEligibility" value="<%= booking.paroleEligibility ? booking.paroleEligibility.toISOString().split('T')[0] : '' %>" class="w-full border rounded p-2">
            </div>
            <button type="submit" class="bg-blue-500 text-white p-2 rounded">Update</button>
          </form>
        </div>
      <% }) %>
    </div>
  </div>

  <script>
    function openTab(evt, tabName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tab-content");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tab-button");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(tabName).style.display = "block";
      evt.currentTarget.className += " active";
    }
  </script>
</body>
</html>
